(()=>{"use strict";class t{constructor(){if(this.recognition=null,this.isRecording=!1,t.instance)return t.instance;t.instance=this,this.init()}init(){this.setupMessageListener(),this.setupKeyboardListener(),this.setupSpeechRecognition(),this.log("Content script loaded")}setupMessageListener(){chrome.runtime.onMessage.addListener((t,e,n)=>(this.handleMessage(t,e,n),!0))}async handleMessage(t,e,n){try{if(this.log("Received message:",t),"buttonClicked"!==t.action)throw new Error(`Unknown action: ${t.action}`);await this.handleButtonClick(),n({status:"success",message:"Button click handled"})}catch(t){console.error("Content script error:",t),n({status:"error",message:t instanceof Error?t.message:"Unknown error"})}}async handleButtonClick(){this.log("Button clicked in popup"),this.addVisualIndicator()}addVisualIndicator(){const t=document.getElementById("unmute-indicator");t&&t.remove();const e=document.createElement("div");e.id="unmute-indicator",e.textContent="Unmute Extension Active!",e.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: #1a73e8;\n      color: white;\n      padding: 12px 16px;\n      border-radius: 6px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      font-weight: 500;\n      z-index: 10000;\n      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n      transition: opacity 0.3s ease;\n    ",document.body.appendChild(e),setTimeout(()=>{e.style.opacity="0",setTimeout(()=>e.remove(),300)},3e3)}setupKeyboardListener(){document.addEventListener("keydown",t=>{const e=t.metaKey||t.ctrlKey,n=t.shiftKey,i="Space"===t.code;e&&n&&i&&(t.preventDefault(),this.toggleSpeechRecording(),this.printTracking())})}async printTracking(){this.log("tracking");try{const t=(await chrome.storage.local.get(["trackingStats"])).trackingStats||{totalCount:0,lastPress:"Never"},e=(new Date).toLocaleTimeString(),n={totalCount:t.totalCount+1,lastPress:e};await chrome.storage.local.set({trackingStats:n});try{await chrome.runtime.sendMessage({action:"trackingUpdate"})}catch(t){}}catch(t){console.error("Error updating tracking stats:",t)}}setupSpeechRecognition(){const t=window.SpeechRecognition||window.webkitSpeechRecognition;t?(this.recognition=new t,this.recognition&&(this.recognition.continuous=!1,this.recognition.interimResults=!0,this.recognition.lang="en-US",this.recognition.onstart=()=>{this.log("Speech recognition started"),this.isRecording=!0,this.showRecordingIndicator()},this.recognition.onresult=t=>{let e="",n=!1;for(let i=t.resultIndex;i<t.results.length;i++){const o=t.results[i];e+=o[0].transcript,o.isFinal&&(n=!0)}this.log("Speech recognition result:",{transcript:e,isFinal:n}),this.updateTranscriptDisplay(e,n),n&&this.handleFinalTranscript(e)},this.recognition.onerror=t=>{this.log("Speech recognition error:",t.error),this.isRecording=!1,this.showErrorIndicator(`Speech recognition error: ${t.error}`)},this.recognition.onend=()=>{this.log("Speech recognition ended"),this.isRecording=!1,this.hideRecordingIndicator()},this.log("Speech recognition setup complete"))):this.log("Speech recognition not supported in this browser")}toggleSpeechRecording(){if(this.recognition)if(this.isRecording)this.recognition.stop(),this.log("Stopping speech recognition");else try{this.recognition.start(),this.log("Starting speech recognition")}catch(t){this.log("Error starting speech recognition:",t),this.showErrorIndicator("Could not start speech recognition")}else this.showErrorIndicator("Speech recognition not available")}showRecordingIndicator(){const t=document.getElementById("unmute-recording-indicator");t&&t.remove();const e=document.createElement("div");e.id="unmute-recording-indicator",e.innerHTML='\n      <div style="display: flex; align-items: center; gap: 12px;">\n        <div class="recording-dot"></div>\n        <div class="recording-text">\n          <div style="font-weight: bold; font-size: 16px;">üé§ Recording...</div>\n          <div id="transcript-display" style="font-size: 14px; opacity: 0.8; margin-top: 4px;"></div>\n        </div>\n      </div>\n    ',e.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: rgba(0, 0, 0, 0.9);\n      color: white;\n      padding: 16px 20px;\n      border-radius: 12px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      z-index: 10000;\n      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n      border: 2px solid #ff4444;\n      backdrop-filter: blur(10px);\n      max-width: 300px;\n      word-wrap: break-word;\n    ";const n=document.createElement("style");n.textContent="\n      .recording-dot {\n        width: 12px;\n        height: 12px;\n        background: #ff4444;\n        border-radius: 50%;\n        animation: recording-pulse 1s infinite;\n      }\n      @keyframes recording-pulse {\n        0% { opacity: 1; transform: scale(1); }\n        50% { opacity: 0.5; transform: scale(1.2); }\n        100% { opacity: 1; transform: scale(1); }\n      }\n    ",document.head.appendChild(n),document.body.appendChild(e)}updateTranscriptDisplay(t,e){const n=document.getElementById("transcript-display");n&&(n.textContent=t||"Listening...",n.style.opacity=e?"1":"0.7",n.style.fontStyle=e?"normal":"italic")}handleFinalTranscript(t){this.log("Final transcript:",t),setTimeout(()=>{this.showTranscriptResult(t)},500)}showTranscriptResult(t){const e=document.getElementById("unmute-recording-indicator");e&&e.remove();const n=document.createElement("div");n.id="unmute-transcript-result",n.innerHTML=`\n      <div style="margin-bottom: 8px; font-weight: bold;">‚úÖ Speech Recognized:</div>\n      <div style="font-size: 14px; background: rgba(255,255,255,0.1); padding: 8px; border-radius: 6px; word-wrap: break-word;">\n        "${t}"\n      </div>\n    `,n.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: rgba(0, 100, 0, 0.9);\n      color: white;\n      padding: 16px 20px;\n      border-radius: 12px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      z-index: 10000;\n      box-shadow: 0 4px 20px rgba(0, 100, 0, 0.3);\n      border: 2px solid #00ff00;\n      backdrop-filter: blur(10px);\n      max-width: 300px;\n      word-wrap: break-word;\n    ",document.body.appendChild(n),setTimeout(()=>{n.style.opacity="0",n.style.transform="translateX(100%)",n.style.transition="all 0.3s ease",setTimeout(()=>n.remove(),300)},4e3)}showErrorIndicator(t){const e=document.getElementById("unmute-recording-indicator");e&&e.remove();const n=document.createElement("div");n.innerHTML=`\n      <div style="display: flex; align-items: center; gap: 8px;">\n        <span>‚ùå</span>\n        <span>${t}</span>\n      </div>\n    `,n.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: rgba(200, 0, 0, 0.9);\n      color: white;\n      padding: 12px 16px;\n      border-radius: 8px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      z-index: 10000;\n      box-shadow: 0 4px 20px rgba(200, 0, 0, 0.3);\n      backdrop-filter: blur(10px);\n    ",document.body.appendChild(n),setTimeout(()=>{n.style.opacity="0",n.style.transition="opacity 0.3s ease",setTimeout(()=>n.remove(),300)},3e3)}hideRecordingIndicator(){const t=document.getElementById("unmute-recording-indicator");t&&(t.style.opacity="0",t.style.transition="opacity 0.3s ease",setTimeout(()=>t.remove(),300))}log(t,...e){console.log(`[Unmute Content Script] ${t}`,...e)}}new t})();