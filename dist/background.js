(()=>{"use strict";class t{constructor(){if(t.instance)return t.instance;t.instance=this,this.init()}init(){this.setupInstallListener(),this.setupActionListener(),this.setupContextMenus(),this.log("Background service initialized")}setupInstallListener(){chrome.runtime.onInstalled.addListener(t=>{this.log("Extension installed/updated:",t.reason),"install"===t.reason?this.handleFirstInstall():"update"===t.reason&&this.handleUpdate(t.previousVersion)})}setupActionListener(){chrome.action.onClicked.addListener(async t=>{this.log("Extension icon clicked for tab:",t.id);try{if(!t.id)throw new Error("No tab ID available");await this.handleIconClick(t)}catch(t){console.error("Error handling icon click:",t)}})}setupContextMenus(){chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:"unmute-action",title:"Unmute Action",contexts:["page","selection"]})}),chrome.contextMenus.onClicked.addListener((t,e)=>{this.log("Context menu clicked:",t.menuItemId),"unmute-action"===t.menuItemId&&e?.id&&this.handleContextMenuClick(t,e)})}async handleFirstInstall(){this.log("First time installation"),await chrome.storage.sync.set({isEnabled:!0,settings:{autoActivate:!1,showNotifications:!0}})}async handleUpdate(t){this.log("Extension updated from version:",t);try{(await chrome.storage.sync.get(["settings"])).settings||await chrome.storage.sync.set({settings:{autoActivate:!1,showNotifications:!0}})}catch(t){console.error("Error during update migration:",t)}}async handleIconClick(t){if(t.id)try{await chrome.tabs.sendMessage(t.id,{action:"iconClicked",tabInfo:{id:t.id,url:t.url,title:t.title}})}catch(e){await this.injectContentScript(t.id)}}async handleContextMenuClick(t,e){if(e.id)try{await chrome.tabs.sendMessage(e.id,{action:"contextMenuClicked",menuInfo:t})}catch(t){console.error("Error sending context menu message:",t)}}async injectContentScript(t){try{await chrome.scripting.executeScript({target:{tabId:t},files:["content.js"]}),this.log("Content script injected into tab:",t)}catch(t){console.error("Failed to inject content script:",t)}}log(t,...e){console.log(`[Unmute Background] ${t}`,...e)}}new t})();